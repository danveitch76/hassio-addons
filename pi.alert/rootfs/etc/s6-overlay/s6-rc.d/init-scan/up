#!/usr/bin/with-contenv bashio
# shellcheck shell=bash
# ==============================================================================
# Start init-scan service
# ==============================================================================
bashio::log.green "Starting up First Scan..."
bashio::log.green "Starting init-scan..."
bashio::log.info "Starting Vendor Update..."
RESULT1=$(/usr/bin/python /root/pialert/back/pialert.py update_vendors_silent)
bashio::log.green "Completed Vendor update."
bashio::log.info "Starting Internet IP Update..."
RESULT2=$(/usr/bin/python /root/pialert/back/pialert.py internet_IP)
bashio::log.green "Completed Internet IP update."
bashio::log.info "Starting Update Scan..."
RESULT3=$(/usr/bin/python /root/pialert/back/pialert.py 1)
bashio::log.green "Completed Update Scan."
timestamp=$(date "+%Y-%m-%d %H:%M:%S %z")

bashio::log.blue "--------------- init-scan Results ----------------"
bashio::log.green "Request timstamp: $timestamp"
bashio::log.debug "Update Vendors output: ${RESULT1}"
bashio::log.debug "Get Internet Address output: ${RESULT2}"
bashio::log.debug "First Update output: ${RESULT3}"
bashio::log.blue "---------------------------------------------------"

bashio::log.info "init-scan stopped"
exit 0
